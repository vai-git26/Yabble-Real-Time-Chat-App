{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dropdown Example</title>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="{% static 'css/header.css' %}">
  <link rel="stylesheet" href="{% static 'css/chatdropdown.css' %}">

  
</head>
<body>

  <header>
    <div>
      <a href="/" class="flex items-cent">
        <img class="h-6" src="/static/images/logo.svg" alt="Logo"/>
        <span>Yabble</span>
      </a>
      <div id="online-user-count"></div>

    </div>
    <nav>

      <ul class="navitems flex items-center justify-center h-full" >
          {% if request.user.is_authenticated %}
          
          <li x-data="{ dropdownChatOpen: false }" class="relative"
              hx-ext="ws"
              ws-connect = "/ws/online-status/">
              <a @click="dropdownChatOpen = !dropdownChatOpen" @click.away="dropdownChatOpen = false" href="#" class="dropdown-trigger">
                Chat
                <img :class="dropdownChatOpen ? 'rotate-180' : ''" src="https://img.icons8.com/small/32/777777/expand-arrow.png" alt="Dropdown arrow">
              </a>
              
              <div :class="dropdownChatOpen ? 'dropdown-menu show' : 'dropdown-menu'">
                <ul class="dropdown-list">
                  <li><a href="{% url 'home' %}">Public Chat</a></li>   
                  {% for chatroom in user.chat_groups.all %}
                  {% if chatroom.groupchat_name %}
                  <li>
                    <a class="leading-5" href="{% url 'chatroom' chatroom.group_name %}">
                      {{ chatroom.groupchat_name|slice:":30"}}
                    </a>
                  </li> 
                  {% endif %}
                  {% endfor %}
                  
                  {% for chatroom in user.chat_groups.all %}
                    {% if chatroom.is_private and chatroom.chat_messages.exists %}
                      {% for member in chatroom.members.all %}
                        {% if member != user %}
                          <li><a href="{% url 'chatroom' chatroom.group_name %}">{{ member.profile.name }}</a></li>
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                  {% endfor %}
                </ul>
                <div id="chats-list"></div>
              </div>
          </li>
          
          <li x-data="{ dropdownOpen: false }" style="position: relative;">
          <a @click="dropdownOpen = !dropdownOpen"
              @click.away="dropdownOpen = false"
              class="cursor-pointer">
              <img class="h-8" src="{{ user.profile.avatar }}" />
              {{ user.profile.name }}
              <img :class="dropdownOpen ? 'rotate-180' : ''" class="w-4"
                  src="https://img.icons8.com/small/32/ffffff/expand-arrow.png"/>
          </a>
          <div x-show="dropdownOpen" x-cloak class="dropdown" x-transition>
              <ul class="hoverlist">
              <li><a href="{% url 'profile' %}">My Profile</a></li>
              <li><a href="{% url 'profile-edit' %}">Edit Profile</a></li>
              <li><a href="{% url 'new-groupchat' %}">Create Chat</a></li>
              <li><a href="{% url 'profile-settings' %}">Settings</a></li>
              <li><a href="{% url 'account_logout' %}">Log Out</a></li>
              </ul>
          </div>
          </li>
      {% else %}
          <li><a href="{% url 'account_login' %}">Login</a></li>
          <li><a href="{% url 'account_signup' %}">Signup</a></li>
      {% endif %}
      </ul>



    </nav>

  </header>

</body>
</html>
